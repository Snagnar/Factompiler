# Test 6: Functions and modularity
# Tests: func declaration, function calls, parameter passing, scoping

func double_signal(x) {
    return x * 2;
}

func conditional_add(a, b, condition) {
    let result = a + (b * condition);
    return result;
}

func memory_toggle() {
    mem toggle_state = memory(0);
    let current = read(toggle_state);
    let new_state = 1 - current;  # toggle between 0 and 1
    write(toggle_state, new_state);
    return new_state;
}

# Use functions
let input_val = input(0);
let doubled = double_signal(input_val);

let condition = input(1) > 0;
let computed = conditional_add(input_val, 5, condition);

let toggle_output = memory_toggle();

# Nested function calls
let complex_result = conditional_add(
    double_signal(input_val),
    input(2),
    toggle_output
);
