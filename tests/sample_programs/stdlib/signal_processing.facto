# Signal processing library  
# Provides filtering and signal manipulation functions

func smooth_filter(Signal signal, int window_size) {
    # Simple moving average filter
    Memory accumulator: "signal-0";
    Memory sample_count: "signal-0";

            
    Signal current_sum = accumulator.read();
    Signal count = sample_count.read();
    
    Signal new_sum = current_sum + signal;
    Signal new_count = count + 1;
    
    # Reset when window is full
    Signal should_reset = new_count >= window_size;
    Signal final_sum = should_reset * signal + (1 - should_reset) * new_sum;
    Signal final_count = should_reset * 1 + (1 - should_reset) * new_count;
    
    accumulator.write(final_sum);
    sample_count.write(final_count);
    
    return final_sum / final_count;
}

func high_pass_filter(Signal signal, int cutoff) {
    # Simple high-pass filter
    Memory last_input: "signal-0";
    Memory last_output: "signal-0";

            
    Signal last_in = last_input.read();
    Signal last_out = last_output.read();
    
    # High-pass: output = signal - last_input + 0.9 * last_output
    Signal output = signal - last_in + (last_out * 9) / 10;
    
    last_input.write(signal);
    last_output.write(output);
    
    return (output > cutoff) * output;
}

func low_pass_filter(Signal signal, int cutoff) {
    # Simple low-pass filter  
    Memory filtered_value: "signal-0";

        
    Signal current = filtered_value.read();
    # Low-pass: output = 0.1 * signal + 0.9 * last_output
    Signal output = (signal + current * 9) / 10;
    
    filtered_value.write(output);
    
    return (output < cutoff) * output + (output >= cutoff) * cutoff;
}

func combine_signals(Signal signal_a, Signal signal_b, Signal signal_c) {
    # Combine three signals with weighting
    Signal weighted_sum = signal_a * 5 + signal_b * 3 + signal_c * 2;
    Signal average = weighted_sum / 10;
    return average;
}
